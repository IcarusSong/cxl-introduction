<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/IcarusSong/cxl-introduction.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">CXL.io</a><ul><li><a href="#h2-1">1.CXL.io协议</a><ul><li><a href="#h3-2">1.1 概述与核心作用</a></li></ul><ul><li><a href="#h3-3">1.2 设备端点与枚举</a></li></ul><ul><li><a href="#h3-4">1.3 CXL 特定的厂商定义消息 (VDM)</a></li></ul><ul><li><a href="#h3-5">1.4. 关键交互与功能要求</a></li></ul><ul><li><a href="#h3-6">1.5 CXL Fabric 中的特定头部</a></li></ul><ul><li><a href="#h3-7">1.6 总结</a></li></ul></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">CXL.io</h1><h2 id="h2-1">1.CXL.io协议</h2><h3 id="h3-2">1.1 概述与核心作用</h3><p>CXL.io 是 CXL (Compute Express Link) 协议栈中的基础层，它为系统中的 I/O 设备提供了非一致性的加载/存储 (load/store) 接口。从根本上说，CXL.io 的设计完全基于 PCIe® 规范，并直接复用了其核心机制。这意味着 CXL.io 在交易类型、包格式、基于信用的流量控制、虚拟通道管理和交易排序规则等方面都遵循 PCIe 的定义。</p><p>在整个 CXL Flex Bus 架构中，CXL.io 与 CXL.cache、CXL.mem 协议并行存在于交易层，它们共享底层的链路层和物理层。CXL.io 的核心作用可以理解为 CXL 体系的基础框架和管理通道，它不仅处理传统的 I/O 事务，还负责设备的发现、配置以及传输关键的控制消息。</p><h3 id="h3-3">1.2 设备端点与枚举</h3><p>一个 CXL 设备能够被主机操作系统识别和管理，完全依赖于 CXL.io 提供的 PCIe 兼容接口。</p><ul><li><b>设备枚举</b> ：系统通过标准的 PCIe 枚举流程，经由 CXL.io 发现 CXL 设备及其功能。</li></ul><ul><li><b>中断处理</b> ：规范对中断消息（INTx）有特殊规定。如果一个功能 (Function) 参与了 CXL.cache 或 CXL.mem 协议，它就不能生成 INTx 消息。不过，不参与这两个协议的纯 I/O 功能（通过 Non-CXL Function Map DVSEC 枚举）可以生成 INTx 消息，尽管这不被推荐。</li></ul><h3 id="h3-4">1.3 CXL 特定的厂商定义消息 (VDM)</h3><p>CXL.io 的一个关键用途是作为通道，来传输 CXL 协议专用的控制和状态消息。这是通过复用 PCIe 的厂商定义消息 (Vendor Defined Message, VDM) 机制实现的。这些 VDM 都使用 CXL 的专属厂商 ID <code>1E98h</code>。</p><ul><li>电源管理 (PM) VDM<ul><li>这些消息用于协调主机和设备之间的电源状态转换，例如 PMREQ (电源请求)、PMRSP (电源响应) 等。</li></ul></li></ul><ul><li><p>错误 (Error) VDM</p><ul><li>这些消息主要用于设备向主机异步报告错误或重要事件。</li></ul></li></ul><ul><li>CXL Fabric 相关 VDM<ul><li>在 CXL Fabric（一种更复杂的拓扑结构）中，VDM 被广泛用于各种管理和控制流程。</li></ul></li></ul><h3 id="h3-5">1.4. 关键交互与功能要求</h3><ul><li>强制要求的 PCIe 功能<ul><li>为了保证 CXL 的正常工作，规范要求所有 CXL 设备都必须支持以下几项在 PCIe 中被定义为 “可选” 的功能：<ul><li><b>传输器端的数据中毒 (Data Poisoning by transmitter)</b>。</li></ul><ul><li><b>地址转换服务 (ATS)</b> ：对于支持 CXL.cache 的设备（Type 1 和 Type 2）是必需的。</li></ul><ul><li><b>高级错误报告 (AER)</b>。</li></ul></li></ul></li></ul><ul><li>通过 ATS 实现内存访问类型指示<ul><li>CXL.io 在协调 CXL.cache 访问方面扮演着至关重要的 “守门人” 角色。<ul><li><b>背景</b> ：某些内存区域（如被映射为 Uncacheable 类型的内存）只能通过 CXL.io 进行非一致性访问，而不能使用 CXL.cache 发起一致性请求。</li></ul><ul><li><b>工作机制</b> ：<ol start="1"><li>CXL 设备在尝试通过 CXL.cache 访问某个地址前，必须先通过 <b>CXL.io</b> 路径发送一个 ATS (Address Translation Service) 请求，以获取主机物理地址 (HPA)。</li></ol><ol start="2"><li>主机在回复的 ATS 完成消息中，会包含一个特殊的 <code>CXL.io</code> 位。</li></ol><ol start="3"><li>如果这个 <code>CXL.io</code> 位被设置为 <code>1</code>，则表示该地址只允许通过 CXL.io 进行访问。设备若尝试使用 CXL.cache 访问该地址，则构成协议违规。</li></ol></li></ul></li></ul></li></ul><h3 id="h3-6">1.5 CXL Fabric 中的特定头部</h3><p>在 PBR (Port Based Routing) Fabric 这种高级拓扑中，CXL.io 的 TLP (Transaction Layer Packet) 格式有一些特殊之处。</p><ul><li><b>PBR TLP 报头 (PTH)</b> ：在 PBR 链路上，几乎所有 io TLP 前面都会附加一个 1-DWORD 的 PTH。这个报头包含了源和目的端口 ID 等信息，是实现精确路由的关键。</li></ul><ul><li><b>VendPrefixLO</b> ：在非 MLD（Multi-Logical Device）的边缘链路上，这个本地前缀被用来携带 PBR-ID，以支持主机和设备间的跨域通信。</li></ul><h3 id="h3-7">1.6 总结</h3><p>CXL.io 远不止是一个简单的 I/O 数据通道。它是整个 CXL 体系的基石和控制总线，承担着至关重要的底层任务：</p><ol start="1"><li><b>身份与发现</b> ：它是系统识别和枚举 CXL 设备的唯一途径。</li></ol><ol start="2"><li><b>管理与控制</b> ：它承载了 CXL 特有的电源管理、错误报告和 Fabric 控制等关键消息。</li></ol><ol start="3"><li><b>规则与边界</b> ：它通过 ATS 机制，严格划分了 CXL.cache 和 CXL.io 的访问权限，是实现混合协议访问模型的关键。</li></ol></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../md-docs/reference" >reference</a></li></ul><ul><li><a href="../../md-docs/CXL_System_Architecture" >CXL_System_Architecture</a></li></ul><ul><li><a href="../../CXL简介/CXL初认识" >CXL简介</a><ul><li><a href="../../CXL简介/CXL初认识" >CXL初认识</a></li></ul><ul><li><a href="../../CXL简介/CXL子协议" >CXL子协议</a></li></ul><ul><li><a href="../../CXL简介/CXL2.0介绍" >CXL2.0介绍</a></li></ul><ul><li><a href="../../CXL简介/CXL3.0介绍" >CXL3.0介绍</a></li></ul><ul><li><a href="../../CXL简介/CXL3.1和CXL3.2" >CXL3.1和CXL3.2</a></li></ul></li></ul><ul><li><a href="../../CXL_Transaction_Layer/CXL.io" >CXL_Transaction_Layer</a><ul><li><a href="../../CXL_Transaction_Layer/CXL.io" >CXL.io</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/CXL.mem" >CXL.mem</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/CXL.cache" >CXL.cache</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/Transaction_Ordering_Summary" >Transaction_Ordering_Summary</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/Transaction Flows to Device-attached Memory" >Transaction Flows to Device-attached Memory</a></li></ul></li></ul><ul><li><a href="../../Switching/Overview" >Switching</a><ul><li><a href="../../Switching/Overview" >Overview</a></li></ul><ul><li><a href="../../Switching/7.2 Switch Configuration and Composition" >7.2 Switch Configuration and Composition</a></li></ul><ul><li><a href="../../Switching/7.3 CXL.io, CXL.cachemem Decode and Forwarding" >7.3 CXL.io, CXL.cachemem Decode and Forwarding</a></li></ul><ul><li><a href="../../Switching/7.6 Fabric Manager Application Programming Interface" >7.6 Fabric Manager Application Programming Interface</a></li></ul><ul><li><a href="../../Switching/7.7 CXL Fabric Architecture" >7.7 CXL Fabric Architecture</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../CXL简介/CXL3.1和CXL3.2","../../CXL_Transaction_Layer/CXL.mem","ab");</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png");</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/clipboard.svg","../../../img/clipboard-check.svg");</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>