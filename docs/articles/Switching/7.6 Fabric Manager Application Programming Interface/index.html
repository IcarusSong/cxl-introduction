<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/IcarusSong/cxl-introduction.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">7.6 Fabric Manager Application Programming Interface</a><ul><li><a href="#h2-1">7.6.1 CXL Fabric Management (CXL Fabric 管理)</a></li></ul><ul><li><a href="#h2-2">7.6.2 Fabric Management Model (Fabric 管理模型)</a></li></ul><ul><li><a href="#h2-3">7.6.4 CXL Switch Management (CXL 交换机管理)</a><ul><li><a href="#h3-4">7.6.4.1 初始配置</a></li></ul><ul><li><a href="#h3-5">7.6.4.2 动态配置</a></li></ul><ul><li><a href="#h3-6">7.6.4.3 MLD 端口管理</a></li></ul></li></ul><ul><li><a href="#h2-7">7.6.5 MLD Component Management (MLD 组件管理)</a></li></ul><ul><li><a href="#h2-8">7.6.6 系统操作的管理需求 (重要用例)</a></li></ul><ul><li><a href="#h2-9">7.6.7 FM API 命令集</a></li></ul><ul><li><a href="#h2-10">7.6.8 Fabric 管理事件记录</a></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">7.6 Fabric Manager Application Programming Interface</h1><h2 id="h2-1">7.6.1 CXL Fabric Management (CXL Fabric 管理)</h2><p>这一节主要介绍了 Fabric Manager (FM) 的基本概念和角色。</p><ul><li><b>两种配置方式</b>: CXL 设备可以被静态配置，也可以通过一个 Fabric Manager (FM) 进行动态配置。</li></ul><ul><li><b>FM 的定义</b>: FM 是一个外部的<b>逻辑过程</b>，它使用本规范中定义的命令来查询和配置系统的运行状态。它决定何时需要重新配置，并启动相应的命令来执行操作。</li></ul><ul><li><b>FM 的物理形式</b>: FM 可以以多种形式存在，并不局限于某一种特定的硬件。例如：<ul><li>在一台主机上运行的软件。</li></ul><ul><li>在基板管理控制器 (BMC) 上运行的嵌入式软件。</li></ul><ul><li>在另一个 CXL 设备或 CXL 交换机上运行的嵌入式固件。</li></ul><ul><li>在 CXL 设备内部运行的一个状态机。</li></ul></li></ul><h2 id="h2-2">7.6.2 Fabric Management Model (Fabric 管理模型)</h2><p>这一节描述了 FM 与 CXL 设备进行通信和管理的具体模型。 <a data-lightbox="example-1" href="https://pic1.imgdb.cn/item/6863836658cb8da5c88293fa.png"><img loading="lazy" src="https://pic1.imgdb.cn/item/6863836658cb8da5c88293fa.png" alt=""></a></p><ul><li><b>通信接口</b>: FM 通过 <b>Fabric Manager API (FM API)</b> 命令集来配置 CXL 设备。这些命令通过一个名为 <b>CCI (Command Control Interface)</b> 的接口进行传输。</li></ul><ul><li><b>CCI 的暴露方式</b>: 设备可以通过以下两种方式之一暴露其 CCI：<ul><li>通过设备的<b>邮箱寄存器 (Mailbox registers)</b>。</li></ul><ul><li>通过一个<b>支持 MCTP 的接口</b>（例如 SMBus）。</li></ul></li></ul><ul><li><b>管理连接示例</b>: 文件列举了几种 FM 与设备 CCI 之间可能的连接方式：<ul><li><b>直接连接</b>: FM 可以通过任何支持 MCTP 的互连方式（如 SMBus）直接连接到一个 CXL 设备，并直接向该设备发送 FM 命令。</li></ul><ul><li><b>通过交换机隧道化</b>: 如果 FM 直接连接到一个 CXL 交换机，它可以使用交换机作为“隧道”，将 FM 命令传递给连接在该交换机下的 MLD 组件。这是通过向交换机发送一个名为 <b>&quot;Tunnel Management Command&quot;</b> 的特殊命令来实现的。</li></ul><ul><li><b>嵌入式 FM</b>: FM 或其部分功能可以被嵌入到一个 CXL 组件内部。这种情况下，嵌入式 FM 与其所在组件硬件之间的通信接口由厂商自行决定，不在此规范范围内。</li></ul></li></ul><h2 id="h2-3">7.6.4 CXL Switch Management (CXL 交换机管理)</h2><p>这一节定义了 Fabric Manager (FM) 对 CXL 交换机进行的管理活动。</p><ul><li><b>FM 的必要性</b>: 对于基本的交换机功能，由 FM 进行动态配置不是必需的，但如果要支持 <b>MLD</b> 或 <b>CXL Fabric 织物拓扑</b>，则<b>必须</b>使用 FM 进行管理。</li></ul><h3 id="h3-4"><b>7.6.4.1 初始配置</b></h3><ul><li>交换机的非易失性存储器（如 SPI Flash）中，以厂商特定的格式存储了所有必要的初始配置信息。</li></ul><ul><li>这些初始配置包括：<ul><li><b>端口配置</b>: 如端口方向（上行或下行）、宽度、支持的速率等。</li></ul><ul><li><b>虚拟 CXL 交换机 (VCS) 配置</b>: 如每个 VCS 的 vPPB 数量、初始的端口绑定配置等。</li></ul><ul><li><b>CCI 访问设置</b>: 包括任何厂商定义的管理权限设置。</li></ul></li></ul><h3 id="h3-5"><b>7.6.4.2 动态配置</b></h3><ul><li>初始配置完成后，只要交换机上的 CCI 接口可用，FM 就可以向其发送管理命令。</li></ul><ul><li>FM 可以对 CXL 交换机执行以下动态管理操作：<ul><li>查询交换机的信息和配置细节。</li></ul><ul><li>执行端口的绑定或解绑。</li></ul><ul><li>注册以接收和处理来自交换机的事件通知，例如热插拔、意外移除和故障等。</li></ul></li></ul><h3 id="h3-6"><b>7.6.4.3 MLD 端口管理</b></h3><ul><li>一个带有 MLD 端口的交换机<b>必须</b>要有一个 FM 来执行以下管理活动：<ul><li><b>MLD 发现</b>: 识别连接的 MLD 设备。</li></ul><ul><li><b>LD 绑定/解绑</b>: 将 MLD 中的逻辑设备 (LDs) 绑定或解绑到不同的 VCS。</li></ul><ul><li><b>管理命令隧道化</b>: 通过交换机将管理命令转发给 MLD 设备。</li></ul></li></ul><h2 id="h2-7">7.6.5 MLD Component Management (MLD 组件管理)</h2><p>这一节描述了 FM 如何管理 MLD 组件本身（通常是支持内存池化的 Type 3 设备）。 <a data-lightbox="example-1" href="https://pic1.imgdb.cn/item/6863851158cb8da5c8829c27.png"><img loading="lazy" src="https://pic1.imgdb.cn/item/6863851158cb8da5c8829c27.png" alt=""></a></p><ul><li><b>连接方式</b>: FM 可以直接连接到 MLD，或者通过将其管理命令“隧道化”穿过 CXL 交换机的 CCI，来连接到该 MLD 设备。</li></ul><ul><li><b>FM 可执行的操作</b>: FM 可以对 MLD 组件执行以下操作：<ul><li><b>内存分配和 QoS 遥测管理</b>: 例如，为 MLD 中的每个逻辑设备 (LD) 分配多大的内存容量，并管理其服务质量 (QoS)。</li></ul><ul><li><b>安全</b>: 例如，在一个 LD 从主机解绑后，对其进行数据擦除。</li></ul><ul><li><b>错误处理</b>: 管理 MLD 组件上发生的错误。</li></ul></li></ul><h2 id="h2-8">7.6.6 系统操作的管理需求 (重要用例)</h2><p>这部分通过示例说明了 FM 在关键系统操作中的角色和职责。</p><ul><li><b>初始系统发现</b>: FM 启动后，会发现所有直接连接的 CXL 设备，并通过 <code>Identify</code> 命令检查其类型和能力。</li></ul><ul><li><b>CXL 交换机发现</b>: FM 会查询交换机的配置、能力和连接的设备，以建立整个 Fabric 的拓扑视图。</li></ul><ul><li><b>MLD 和交换机 MLD 端口管理</b>: 如果发现 MLD，FM 需要在使用隧道命令对其进行管理，为后续的 LD 绑定做准备。</li></ul><ul><li><b>事件通知</b>: FM 可以向设备注册以接收事件通知，从而能及时响应系统变化，例如 MLD 设备上的“注意按钮”被按下时，协调其热移除流程。</li></ul><ul><li><b>端口和 LD 的绑定/解绑</b>: FM 是执行绑定和解绑操作的核心。绑定一个端口会向主机报告一个<b>热添加 (Hot-Add)</b> 事件；解绑则会触发<b>热移除 (Hot-Remove)</b> 流程。</li></ul><ul><li><b>热插拔和意外移除</b>: FM 负责处理在未绑定端口上发生的热插拔事件，并在 MLD 组件被意外移除时执行错误处理和端口管理活动。</li></ul><h2 id="h2-9">7.6.7 FM API 命令集</h2><p>这部分定义了 FM API 的具体命令集。设备根据其类型和能力，必须或可选地支持这些命令集。</p><ul><li><b>命令集分类</b>:<ul><li><b>Physical Switch (物理交换机)</b>: 管理交换机的物理端口等。</li></ul><ul><li><b>Virtual Switch (虚拟交换机)</b>: 管理 VCS，执行 vPPB 的绑定/解绑。</li></ul><ul><li><b>MLD Port (MLD 端口)</b>: 主要是隧道命令，用于通过交换机管理下游 MLD。</li></ul><ul><li><b>MLD Component (MLD 组件)</b>: 用于配置 MLD 自身的内存分配、QoS 等。</li></ul><ul><li><b>Multi-Headed Device (多头设备)</b>: 用于查询多头设备的 Head-to-LD 映射。</li></ul><ul><li><b>DCD Management (动态容量设备管理)</b>: 用于查询和配置动态容量内存 (Dynamic Capacity Memory)。</li></ul></li></ul><ul><li><b>命令要求</b>: 表格 7-15 中定义了不同设备类型（如 HBR 交换机、MLD）对各个命令集的实现要求（Mandatory/Optional/Prohibited）。</li></ul><h2 id="h2-10">7.6.8 Fabric 管理事件记录</h2><ul><li>FM API 使用一个标准的事件记录框架来报告系统事件。</li></ul><ul><li>本节定义了与 Fabric 管理活动相关的特定事件记录格式，包括：<ul><li><b>物理交换机事件记录 (Physical Switch Event Records)</b>: 报告与物理交换机端口相关的事件，如链路状态变化。</li></ul><ul><li><b>虚拟 CXL 交换机事件记录 (Virtual CXL Switch Event Records)</b>: 报告与 VCS 和 vPPB 相关的事件，如绑定状态变化。</li></ul><ul><li><b>MLD 端口事件记录 (MLD Port Event Records)</b>: 报告与连接到 MLD 的交换机端口相关的事件，如收到来自 MLD 的错误消息。</li></ul></li></ul></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../md-docs/reference" >reference</a></li></ul><ul><li><a href="../../md-docs/CXL_System_Architecture" >CXL_System_Architecture</a></li></ul><ul><li><a href="../../CXL简介/CXL初认识" >CXL简介</a><ul><li><a href="../../CXL简介/CXL初认识" >CXL初认识</a></li></ul><ul><li><a href="../../CXL简介/CXL子协议" >CXL子协议</a></li></ul><ul><li><a href="../../CXL简介/CXL2.0介绍" >CXL2.0介绍</a></li></ul><ul><li><a href="../../CXL简介/CXL3.0介绍" >CXL3.0介绍</a></li></ul><ul><li><a href="../../CXL简介/CXL3.1和CXL3.2" >CXL3.1和CXL3.2</a></li></ul></li></ul><ul><li><a href="../../CXL_Transaction_Layer/CXL.io" >CXL_Transaction_Layer</a><ul><li><a href="../../CXL_Transaction_Layer/CXL.io" >CXL.io</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/CXL.mem" >CXL.mem</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/CXL.cache" >CXL.cache</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/Transaction_Ordering_Summary" >Transaction_Ordering_Summary</a></li></ul><ul><li><a href="../../CXL_Transaction_Layer/Transaction Flows to Device-attached Memory" >Transaction Flows to Device-attached Memory</a></li></ul></li></ul><ul><li><a href="../../Switching/Overview" >Switching</a><ul><li><a href="../../Switching/Overview" >Overview</a></li></ul><ul><li><a href="../../Switching/7.2 Switch Configuration and Composition" >7.2 Switch Configuration and Composition</a></li></ul><ul><li><a href="../../Switching/7.3 CXL.io, CXL.cachemem Decode and Forwarding" >7.3 CXL.io, CXL.cachemem Decode and Forwarding</a></li></ul><ul><li><a href="../../Switching/7.6 Fabric Manager Application Programming Interface" >7.6 Fabric Manager Application Programming Interface</a></li></ul><ul><li><a href="../../Switching/7.7 CXL Fabric Architecture" >7.7 CXL Fabric Architecture</a></li></ul></li></ul><ul><li><a href="../../spec9.0/9.1 CXL Boot and Reset Overview" >spec9.0</a><ul><li><a href="../../spec9.0/9.1 CXL Boot and Reset Overview" >9.1 CXL Boot and Reset Overview</a></li></ul><ul><li><a href="../../spec9.0/9.5 Function Level Reset (FLR)" >9.5 Function Level Reset (FLR)</a></li></ul><ul><li><a href="../../spec9.0/9.6 Cache Management" >9.6 Cache Management</a></li></ul><ul><li><a href="../../spec9.0/9.7 CXL Reset" >9.7 CXL Reset</a></li></ul><ul><li><a href="../../spec9.0/9.9 Hot-Plug" >9.9 Hot-Plug</a></li></ul><ul><li><a href="../../spec9.0/9.11 RCD Enumeration" >9.11 RCD Enumeration</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../Switching/7.3 CXL.io, CXL.cachemem Decode and Forwarding","../../Switching/7.7 CXL Fabric Architecture","ab");</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png");</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/clipboard.svg","../../../img/clipboard-check.svg");</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>