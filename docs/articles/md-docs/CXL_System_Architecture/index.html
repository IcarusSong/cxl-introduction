<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/IcarusSong/cxl-introduction.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">CXL_System_Architecture</a><ul><li><a href="#h2-1">一、CXL 核心概念与设备类型</a><ul><li><a href="#h3-2">CXL 设备的三种类型</a></li></ul></li></ul><ul><li><a href="#h2-3">二、主机管理设备内存（HDM）与一致性模型</a><ul><li><a href="#h3-4">1. HDM-D：基于偏置的一致性模型</a></li></ul><ul><li><a href="#h3-5">2. HDM-DB：基于反向无效化侦测的一致性</a></li></ul></li></ul><ul><li><a href="#h2-6">三、高级设备配置与扩展</a><ul><li><a href="#h3-7">1. 多逻辑设备（Multi-Logical Device - MLD）</a></li></ul><ul><li><a href="#h3-8">2. 多头设备（Multi-Headed Device）</a></li></ul></li></ul><ul><li><a href="#h2-9">四、CXL Fabric 与可扩展内存架构</a><ul><li><a href="#h3-10">1. CXL Fabric</a></li></ul><ul><li><a href="#h3-11">2. Fabric 附加内存（Fabric-Attached Memory - FAM）</a></li></ul><ul><li><a href="#h3-12">3. 共享 FAM 的一致性模型</a></li></ul></li></ul><ul><li><a href="#h2-13">五、可管理性（Manageability）</a></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">CXL_System_Architecture</h1><h2 id="h2-1">一、CXL 核心概念与设备类型</h2><p>CXL（Compute Express Link）是一种用于互联外设的高性能 I/O 总线架构。它可以连接传统 I/O 设备、内存设备或具有额外能力的加速器。</p><h3 id="h3-2">CXL 设备的三种类型</h3><ol start="1"><li><b>Type 1 设备（缓存设备 - CXL Device w/o Memory）</b><ul><li><b>核心特征</b>：内部拥有与主机一致的缓存，但不带自己的内存。</li></ul><ul><li><b>协议</b>：使用 <code>CXL.cache</code> 和 <code>CXL.io</code>。</li></ul><ul><li><b>应用场景</b>：用于需要执行复杂原子操作或自定义排序模型的加速器，标准的生产者 - 消费者模型已无法满足需求。其缓存容量受限于主机的窥探过滤能力。</li></ul></li></ol><ol start="2"><li><b>Type 2 设备（带内存的缓存设备 - CXL Device w/ Memory）</b><ul><li><b>核心特征</b>：同时拥有与主机一致的缓存和自己附加的内存（如 DDR，HBM）。</li></ul><ul><li><b>协议</b>：唯一一种协商并使用全部三种协议的设备：<code>CXL.cache</code>，<code>CXL.mem</code> 和 <code>CXL.io</code>。</li></ul><ul><li><b>应用场景</b>：需要在自身附加内存和主机之间进行高带宽、低延迟数据交换的加速器，如 GPGPU。</li></ul></li></ol><ol start="3"><li><b>Type 3 设备（内存设备 - CXL Memory Expander/Accelerator）</b><ul><li><b>核心特征</b>：拥有自己附加的内存，但没有与主机一致的缓存。</li></ul><ul><li><b>协议</b>：使用 <code>CXL.mem</code> 和 <code>CXL.io</code>。</li></ul><ul><li><b>应用场景</b>：作为主机的内存扩展器，或者在特定模式下作为存内计算等类型的加速器。</li></ul></li></ol><h2 id="h2-3">二、主机管理设备内存（HDM）与一致性模型</h2><p>当 Type 2 和 Type 3 设备的内存暴露给主机时，被称为主机管理设备内存（Host-managed Device Memory，HDM）。HDM 的一致性管理有三种模式：</p><ul><li><b>HDM-H（Host-only Coherent）</b>：完全由主机负责一致性。</li></ul><ul><li><b>HDM-D（Device Coherent）</b>：设备通过 CXL.cache 参与一致性管理。</li></ul><ul><li><b>HDM-DB（Device Coherent using Back-Invalidate Snoop）</b>：设备通过 CXL.mem 中的专用通道管理一致性。</li></ul><h3 id="h3-4"><ol start="1"><li>HDM-D：基于偏置的一致性模型</li></ol></h3><p>这是一种性能优化模型，通过切换内存的“偏置”状态，来决定在某一时刻优先满足主机还是设备的访问性能。</p><ul><li><b>主机偏置（Host Bias）</b>：主机访问设备内存的性能最优，而设备访问则需通过主机，性能受限。适用于主机准备数据或回收结果的阶段。</li></ul><ul><li><b>设备偏置（Device Bias）</b>：设备访问其本地内存的性能最优（无需通过主机），而主机的访问性能则受影响。适用于设备执行计算的阶段。</li></ul><ul><li><b>模式管理</b>：CXL 支持两种偏置管理方案。<ul><li><b>软件辅助</b>：由软件（驱动）根据可预测的应用流程来发起偏置转换。</li></ul><ul><li><b>硬件自主</b>：由硬件根据实时的访问请求来预测和调整偏置状态，适用于访问模式复杂的应用。</li></ul></li></ul><h3 id="h3-5"><ol start="2"><li>HDM-DB：基于反向无效化侦测的一致性</li></ol></h3><ul><li><b>核心机制</b>：在 <code>CXL.mem</code> 协议中增加了专用的 BISnp（Back-Invalidate Snoop）和 BIRsp（Back-Invalidate Response）通道，让设备可以直接向主机发起窥探请求。</li></ul><ul><li><b>重要性</b>：<ul><li>它取代了使用 <code>CXL.cache</code> 来管理 HDM 一致性的方法。</li></ul><ul><li>所有支持 256B Flit 模式的设备都必须支持此功能。</li></ul><ul><li>它是实现多个 Type 1/Type 2 设备扩展的关键，允许单个主机桥下连接最多 16 个此类设备。</li></ul></li></ul><h2 id="h2-6">三、高级设备配置与扩展</h2><h3 id="h3-7"><ol start="1"><li>多逻辑设备（Multi-Logical Device - MLD）</li></ol></h3><ul><li><b>定义</b>：一种 Type 3 设备，可将其内部资源分割成最多 16 个相互隔离的逻辑设备（LD）。</li></ul><ul><li><b>管理</b>：由 Fabric Manager（FM）通过一个特殊的 FM-owned LD（FMLD）进行管理。</li></ul><ul><li><b>LD-ID</b>：使用逻辑设备 ID 来区分，CXL.io 支持 16 位，而 CXL.mem 只支持 4 位。</li></ul><ul><li><b>寄存器</b>：MLD 中普通 LD 的物理链路相关寄存器是被虚拟化的，写入无效或仅镜像 FMLD 的状态，以确保对共享资源的统一控制。</li></ul><h3 id="h3-8"><ol start="2"><li>多头设备（Multi-Headed Device）</li></ol></h3><ul><li><b>定义</b>：一种拥有多个 CXL 物理端口（“头”）的 Type 3 设备。</li></ul><ul><li><b>类型</b>：<ul><li><b>MH-SLD</b>：所有“头”都呈现为单逻辑设备（SLD），头与 LD 之间为 1：1 映射。</li></ul><ul><li><b>MH-MLD</b>：可以在“头”上呈现为多逻辑设备（MLD），多个 LD 可映射到单个“头”。</li></ul></li></ul><ul><li><b>LD 池</b>：整个物理设备的 LD 池可以支持超过 16 个 LD，因为 16 的限制是针对单个“头”的（源于 CXL.mem 的 4 位 LD-ID）。设备通过本地 ID 到全局 ID 的映射机制来管理。</li></ul><ul><li><b>管理</b>：所有多头设备的内存资源管理都遵循 MLD 模型，必须支持以 LD 为基础的资源隔离。</li></ul><h2 id="h2-9">四、CXL Fabric 与可扩展内存架构</h2><h3 id="h3-10"><ol start="1"><li>CXL Fabric</li></ol></h3><ul><li><b>定义</b>：依赖于基于端口的路由（PBR）的高级交换拓扑，可实现灵活、低延迟、大规模（最多 4096 个 PID）的互联。</li></ul><h3 id="h3-11"><ol start="2"><li>Fabric 附加内存（Fabric-Attached Memory - FAM）</li></ol></h3><ul><li><b>定义</b>：由支持多主机的设备所暴露的内存。</li></ul><ul><li><b>共享模式</b>：<ul><li><b>池化内存（Pooled FAM）</b>：每个内存区域专用于单个主机。</li></ul><ul><li><b>共享内存（Shared FAM）</b>：多个主机可并发访问同一内存区域。</li></ul></li></ul><ul><li><b>实现方式</b>：<ul><li><b>LD-FAM</b>：通过 MLD/MH-SLD 等逻辑设备形式暴露。</li></ul><ul><li><b>G-FAM（Global-FAM）</b>：通过 PBR 链路连接到 CXL Fabric，具有更高的可扩展性。</li></ul></li></ul><h3 id="h3-12"><ol start="3"><li>共享 FAM 的一致性模型</li></ol></h3><p>当多个主机共享 FAM 时，由 FM 指定一致性模型。</p><ul><li><b>多主机硬件一致性</b>：MLD 设备硬件负责跟踪和维护跨主机的一致性。写入操作必须是两阶段的（先获取所有权，再写入）。</li></ul><ul><li><b>软件管理的一致性</b>：硬件不负责，完全由各主机上的软件通过协调机制来保证一致性。这种模型需要警惕“干净写回”问题，它可能破坏数据一致性。</li></ul><h2 id="h2-13">五、可管理性（Manageability）</h2><p>CXL 采用一个分层、多标准的管理框架。</p><ul><li><b>基础层</b>：通过 PCIe 配置空间和 MMIO 进行设备发现和基础配置。</li></ul><ul><li><b>安全层</b>：通过 DOE 或 MCTP 传输安全管理流量。</li></ul><ul><li><b>高级层</b>：通过组件命令接口（CCI）执行高级管理，命令通过 Mailbox、MCTP 或隧道传输。</li></ul><ul><li><b>平台层</b>：可选地使用 DMTF 的 PLDM 进行平台级监控和固件更新。</li></ul></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../md-docs/reference" >reference</a></li></ul><ul><li><a href="../../md-docs/CXL_System_Architecture" >CXL_System_Architecture</a></li></ul><ul><li><a href="../../md-docs/CXL_Transaction_Layer" >CXL_Transaction_Layer</a></li></ul><ul><li><a href="../../CXL简介/CXL初认识" >CXL简介</a><ul><li><a href="../../CXL简介/CXL初认识" >CXL初认识</a></li></ul><ul><li><a href="../../CXL简介/CXL子协议" >CXL子协议</a></li></ul><ul><li><a href="../../CXL简介/CXL2.0介绍" >CXL2.0介绍</a></li></ul><ul><li><a href="../../CXL简介/CXL3.0介绍" >CXL3.0介绍</a></li></ul><ul><li><a href="../../CXL简介/CXL3.1和CXL3.2" >CXL3.1和CXL3.2</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../md-docs/reference","../../md-docs/CXL_Transaction_Layer","ab");</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png");</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/clipboard.svg","../../../img/clipboard-check.svg");</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>